<!DOCTYPE html>
<html>
  <head>
	<script language="javascript" src="../../bower_components/webcomponentsjs/webcomponents.js"></script>
	<link rel="import" href="../strand-input/strand-input.html">
	<link rel="import" href="../strand-dropdown/strand-dropdown.html">
	<link rel="import" href="strand-item-recycler.html">
	<style type="text/css">
		html, body {
			padding: 0;
			margin: 0;
			background: #eee;
		}

		strand-item-recycler[unresolved] {
			display: none;
		}

		strand-item-recycler {
			height: 500px;
			/*padding-top: 30px;*/
		}

		._mm_item {
			background: #fff;
			border-bottom: 1px solid #ccc;
			padding: 10px;
		}

		#header {
			/*position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 30px;*/
			background: #ccc;
		}

		#footer {
			background: #ccc;
		}

	</style>
  </head>
  <body>

	<button id="switch">toggle</button>
	<div id="toggle" style="display: notnone">
		<strand-item-recycler id="itemRecycler" unresolved>
			<div id="header" recycler="header" style="width: 100%;">Header <br/> Text</div>
			<div id="footer" recycler="footer">Footer <br/> Text <br/> Too</div>
			Hello World
			<template preserve-content>
				<div class="_mm_item" data-id="{{model.id}}" style$="{{model.style}}">
					<strand-input value="{{model.name}}"></strand-input><span>{{model.num}}</span>

					<strand-dropdown placeholder="Some Very Long Name" data="{{model.dd.dropdownData}}" value="{{model.dd.dropDownValue}}"></strand-dropdown>
					<strand-item-recycler id="itemRecyclerA" unresolved style="height: 100px; width: 50%; display: inline-block;" data="{{model.nested}}">
						
						<template preserve-content>
							<strand-dropdown data="{{model.deep}}"></strand-dropdown>
							<div class="_mm_item" data-id="{{model.id}}" style$="{{model.style2}}">
								<span>{{model.num}}</span><strand-input value="{{model.name}}"></strand-input>
							</div>
						</template>
					</strand-item-recycler>

				</div>
			</template>

		</strand-item-recycler>
	</div>



		<!--
		<strand-dropdown placeholder="{{model.name}}" value="{{model.value}}">
			<strand-list-item value="0">JPEG</strand-list-item>
			<strand-list-item value="1">GIF</strand-list-item>
			<strand-list-item value="2">SWF</strand-list-item>
			<strand-list-item value="3">PNG</strand-list-item>
		</strand-dropdown>
		-->
	<script type="text/javascript">
		var data = [],
			ddDataArr = [],
			itemRecycler,
			header,
			NUM_ITEMS = 150,
			clone = data;

		for(var j=0; j<10; j++) {
			ddDataArr.push({
				name: "Some Name " + j,
				// value: j
				value: "String" + j
			});
		}

		for(var i=0; i<NUM_ITEMS; i++) {
			generateItem(i);
		}

		clone = JSON.parse(JSON.stringify(data));

		for(var i=0; i<NUM_ITEMS; i++) {
			data[i].nested = JSON.parse(JSON.stringify(clone));
			data[i].dd.dropdownData = JSON.parse(JSON.stringify(ddDataArr));


			data[i].nested.forEach(function (nest) {
				nest.deep = this;
			}, data[i].dd.dropdownData);
		}

		function generateItem(index) {
			data.push({
				num: index,
				//id: i, // id throws an error -- https://github.com/Polymer/polymer/issues/2061
				name: Math.random().toString(36).substring(7),
				advertiser: "Advertiser No. " + i,
				concept: "Concept No. " + i,
				type: "swf",
				file: "Creative_File_" + i + ".swf",
				dimensions: String(Math.floor(Math.random()*300) + " x " + Math.floor(Math.random()*300)),
				//style: "transition: height 2s; height: 50px",
				style: (index < 0 * 12 ? "" : "height: 100px; "),// + "width: 2000px;",
				style2: (index < 0 * 12 ? "" : "height: 80px; "),// + "width: 2000px;",
				size: 50,
				dd:{
					dropdownData: null,
					dropDownValue: "String15"
				}
			});
		}

		window.addEventListener("WebComponentsReady", function() {




			//return;
			var all = [
				document.querySelector("#itemRecycler"),
				document.querySelector("#itemRecycler2"),
				document.querySelector("#itemRecycler3"),
			];
			toggle = document.querySelector("#toggle");
			itemRecycler = all[2];
			(itemRecycler || {}).data = data;
			itemRecycler = all[1];
			(itemRecycler || {}).data = data;
			itemRecycler = all[0];
			(itemRecycler || {}).data = data;

			document.querySelector("#switch").onclick = function () {
				if (toggle.style.display !== "none") {
					toggle.style.display = "none"
				} else {
					toggle.style.display = "";
					all.forEach(function (recycler) {
						recycler && recycler.initialize();
					});
				}
			};

			setTimeout(function () {
				//itemRecycler.data = data.slice(data.length >> 2, data.length >> 1);
			}, 3000);

		// 	setTimeout(function () {
		// 		itemRecycler.style.height = (2 * itemRecycler.offsetHeight) + "px";

		// 		(function loop () {
		// 			var index = 0|(Math.random() * itemRecycler.data.length);
		// 			var datum = itemRecycler.data[index];
		// 			if (datum.size === 50) {
		// 				datum.size = 100;
		// 				itemRecycler.set("data."+index+".style", "transition: height 2s; height: 100px");
		// 			} else {
		// 				datum.size = 50;
		// 				itemRecycler.set("data."+index+".style", "transition: height 2s; height: 50px");
		// 			}
		// 			setTimeout(loop, 1000);
		// 		});
		// 	}, 3000);
		});
	</script>
  </body>
</html>